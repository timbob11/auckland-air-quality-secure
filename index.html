
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AQI Checker - Auckland vs Delhi üåè</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            padding: 20px;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        header p {
            font-size: 1.2em;
            opacity: 0.95;
        }

        .cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin-bottom: 30px;
        }

        .city-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            transition: transform 0.3s ease;
        }

        .city-card:hover {
            transform: translateY(-5px);
        }

        .city-card.loading {
            opacity: 0.6;
        }

        .city-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .city-name {
            font-size: 1.8em;
            font-weight: bold;
            color: #333;
        }

        .flag {
            font-size: 2em;
        }

        .aqi-display {
            text-align: center;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 20px;
            transition: all 0.3s ease;
        }

        .aqi-number {
            font-size: 4em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .aqi-label {
            font-size: 1.5em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .aqi-description {
            margin-top: 10px;
            font-size: 0.9em;
            opacity: 0.8;
        }

        .aqi-good {
            background: linear-gradient(135deg, #00b09b, #96c93d);
            color: white;
        }

        .aqi-fair {
            background: linear-gradient(135deg, #f4d03f, #f9bf3b);
            color: #333;
        }

        .aqi-moderate {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
        }

        .aqi-poor {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }

        .aqi-very-poor {
            background: linear-gradient(135deg, #8e44ad, #6c3483);
            color: white;
        }

        .pollutants {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

        .pollutant {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .pollutant-name {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 5px;
            text-transform: uppercase;
            font-weight: 600;
        }

        .pollutant-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #333;
        }

        .pollutant-unit {
            font-size: 0.7em;
            color: #999;
        }

        .commentary {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            text-align: center;
        }

        .commentary h2 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.8em;
        }

        .commentary p {
            font-size: 1.2em;
            line-height: 1.6;
            color: #555;
        }

        .refresh-btn {
            display: block;
            margin: 30px auto;
            padding: 15px 40px;
            font-size: 1.1em;
            font-weight: bold;
            color: white;
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
        }

        .refresh-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 7px 20px rgba(0,0,0,0.4);
        }

        .refresh-btn:active {
            transform: translateY(0);
        }

        .error {
            background: #e74c3c;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-top: 10px;
            font-size: 0.9em;
        }

        .info-note {
            background: rgba(255,255,255,0.2);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            margin-top: 20px;
            font-size: 0.9em;
        }

        .secure-badge {
            background: rgba(46, 213, 115, 0.2);
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            text-align: center;
            margin-top: 20px;
            font-size: 0.9em;
            border: 2px solid rgba(46, 213, 115, 0.5);
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 2em;
            }
            
            .aqi-number {
                font-size: 3em;
            }
            
            .cards-container {
                grid-template-columns: 1fr;
            }
        }

        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üå¨Ô∏è Air Quality Checker</h1>
            <p>Auckland vs New Delhi - A Reality Check</p>
        </header>

        <div class="cards-container">
            <div class="city-card" id="auckland-card">
                <div class="city-header">
                    <div class="city-name">Auckland</div>
                    <div class="flag">üá≥üáø</div>
                </div>
                <div class="aqi-display" id="auckland-aqi">
                    <div class="loader"></div>
                </div>
                <div class="pollutants" id="auckland-pollutants"></div>
            </div>

            <div class="city-card" id="delhi-card">
                <div class="city-header">
                    <div class="city-name">New Delhi</div>
                    <div class="flag">üáÆüá≥</div>
                </div>
                <div class="aqi-display" id="delhi-aqi">
                    <div class="loader"></div>
                </div>
                <div class="pollutants" id="delhi-pollutants"></div>
            </div>
        </div>

        <div class="commentary" id="commentary">
            <h2>The Verdict</h2>
            <p id="verdict-text">Loading data...</p>
        </div>

        <button class="refresh-btn" onclick="loadAirQuality()">üîÑ Refresh Data</button>

        <div class="secure-badge">
            üîí <strong>Secure!</strong> Your API key is safely stored on the server.
        </div>

        <div class="info-note">
            <p>üí° This app uses serverless functions to keep your API key secure.</p>
        </div>
    </div>

    <script>
        const cities = {
            auckland: { lat: -36.8485, lon: 174.7633, name: 'Auckland' },
            delhi: { lat: 28.6139, lon: 77.2090, name: 'New Delhi' }
        };
        
        function getAQICategory(aqi) {
            const categories = {
                1: { label: 'Good', class: 'aqi-good', desc: 'Sweet as! Air quality is choice!', emoji: 'üòé' },
                2: { label: 'Fair', class: 'aqi-fair', desc: 'Pretty decent, no worries mate', emoji: 'üôÇ' },
                3: { label: 'Moderate', class: 'aqi-moderate', desc: 'A bit dodge, but manageable', emoji: 'üòê' },
                4: { label: 'Poor', class: 'aqi-poor', desc: 'Yeah nah, not great', emoji: 'üò∑' },
                5: { label: 'Very Poor', class: 'aqi-very-poor', desc: 'Proper munted! Stay inside!', emoji: '‚ò†Ô∏è' }
            };
            return categories[aqi] || categories[3];
        }

        function getCommentary(aucklandAQI, delhiAQI) {
            if (aucklandAQI === 1 && delhiAQI >= 4) {
                return "Crikey! üò± The air in Auckland is absolutely choice compared to Delhi. You'll be breathing easy when you get back home, mate!";
            } else if (aucklandAQI <= 2 && delhiAQI >= 3) {
                return "Sweet as! ü•ù Auckland's air is way cleaner than Delhi. Missing that fresh Kiwi air, eh?";
            } else if (Math.abs(aucklandAQI - delhiAQI) <= 1) {
                return "Interesting! Both cities are pretty similar right now. Not too shabby!";
            } else if (delhiAQI < aucklandAQI) {
                return "Whoa! Delhi's actually cleaner right now! That's rare as. Must be a good day! üòÑ";
            } else {
                return "Auckland's got better air quality. Stay safe and hydrated, legend!";
            }
        }

        async function fetchAirQuality(city) {
            try {
                const response = await fetch(
                    `/.netlify/functions/air-quality?lat=${city.lat}&lon=${city.lon}&city=${city.name}`
                );
                
                if (!response.ok) {
                    throw new Error(`API request failed: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                return {
                    aqi: data.aqi,
                    components: data.components
                };
            } catch (error) {
                console.error(`Error fetching data for ${city.name}:`, error);
                throw error;
            }
        }

        function displayAirQuality(cityKey, data) {
            const category = getAQICategory(data.aqi);
            const aqiContainer = document.getElementById(`${cityKey}-aqi`);
            const pollutantsContainer = document.getElementById(`${cityKey}-pollutants`);

            aqiContainer.className = `aqi-display ${category.class}`;
            aqiContainer.innerHTML = `
                <div class="aqi-number">${data.aqi} ${category.emoji}</div>
                <div class="aqi-label">${category.label}</div>
                <div class="aqi-description">${category.desc}</div>
            `;

            pollutantsContainer.innerHTML = `
                <div class="pollutant">
                    <div class="pollutant-name">PM2.5</div>
                    <div class="pollutant-value">${data.components.pm2_5.toFixed(1)} <span class="pollutant-unit">¬µg/m¬≥</span></div>
                </div>
                <div class="pollutant">
                    <div class="pollutant-name">PM10</div>
                    <div class="pollutant-value">${data.components.pm10.toFixed(1)} <span class="pollutant-unit">¬µg/m¬≥</span></div>
                </div>
                <div class="pollutant">
                    <div class="pollutant-name">NO‚ÇÇ</div>
                    <div class="pollutant-value">${data.components.no2.toFixed(1)} <span class="pollutant-unit">¬µg/m¬≥</span></div>
                </div>
                <div class="pollutant">
                    <div class="pollutant-name">O‚ÇÉ</div>
                    <div class="pollutant-value">${data.components.o3.toFixed(1)} <span class="pollutant-unit">¬µg/m¬≥</span></div>
                </div>
            `;
        }

        async function loadAirQuality() {
            document.getElementById('auckland-aqi').innerHTML = '<div class="loader"></div>';
            document.getElementById('delhi-aqi').innerHTML = '<div class="loader"></div>';
            document.getElementById('auckland-pollutants').innerHTML = '';
            document.getElementById('delhi-pollutants').innerHTML = '';
            document.getElementById('verdict-text').textContent = 'Crunching the numbers...';

            try {
                const [aucklandData, delhiData] = await Promise.all([
                    fetchAirQuality(cities.auckland),
                    fetchAirQuality(cities.delhi)
                ]);

                displayAirQuality('auckland', aucklandData);
                displayAirQuality('delhi', delhiData);

                const commentary = getCommentary(aucklandData.aqi, delhiData.aqi);
                document.getElementById('verdict-text').textContent = commentary;

            } catch (error) {
                console.error('Error loading air quality:', error);
                document.getElementById('verdict-text').innerHTML = 
                    '<div class="error">Oops! Couldn\'t fetch the data. Make sure the environment variable is set and the site is redeployed.</div>';
            }
        }

        window.addEventListener('load', loadAirQuality);
    </script>
</body>
</html>

